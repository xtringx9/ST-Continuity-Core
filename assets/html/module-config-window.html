<!-- 模块配置侧边栏HTML -->
<div id="continuity-module-config-window">
    <div class="window-header">
        <h2>Continuity 配置面板</h2>
        <button id="continuity-window-close" class="close-btn">✕</button>
    </div>

    <div class="info-section">
        <p><strong>配置说明：</strong>在此页面可自定义模块，每个模块可设置名称、变量和变量解释。</p>
        <div class="example">
            <p>模块格式：[模块名|变量1:值1|变量2:值2...]</p>
            <p>示例：[seed|id:1|desc:伏笔描述|status:已植入]</p>
        </div>
    </div>

    <!-- 设置区域 -->
    <div class="settings-section">
        <div class="section-title">
            <h3>设置</h3>
        </div>

        <div class="settings-content">
            <div class="setting-group">
                <div class="flex-container">
                    <input id="auto-inject-toggle" type="checkbox" />
                    <label for="auto-inject-toggle">自动注入提示词</label>
                </div>
            </div>

            <div id="injection-settings" class="injection-settings">
                <div class="setting-group">
                    <div class="inline-settings-row">
                        <div class="setting-item">
                            <label for="insertion-role">插入角色</label>
                            <select id="insertion-role" class="role-select">
                                <option value="system">系统 (⚙️)</option>
                                <option value="user">用户 (👤)</option>
                                <option value="assistant">助手 (🤖)</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="insertion-depth">插入深度</label>
                            <input type="number" id="insertion-depth" class="depth-input" min="0" max="10" value="1"
                                title="0 = 最后一条消息之后，1 = 最后一条消息之前，以此类推">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 提示词预览区域 -->
    <div class="prompt-preview-section">
        <div class="section-title">
            <h3>提示词预览</h3>
            <div class="header-actions">
                <button id="toggle-preview-btn" class="btn-small">
                    <span class="toggle-arrow">▶</span> 展开预览
                </button>
                <button id="update-prompt-btn" class="btn-small">更新提示词</button>
                <button id="copy-prompt-btn" class="btn-small">复制提示词</button>
            </div>
        </div>

        <div id="prompt-preview-content" class="preview-content" style="display: none;">
            <div class="preview-section">
                <textarea id="prompt-preview-textarea" class="prompt-preview-textarea" readonly></textarea>
            </div>
        </div>
    </div>

    <div class="custom-modules-container">
        <div class="section-title">
            <h3>自定义模块</h3>
            <div class="header-actions">
                <button id="import-config-btn" class="btn-small">导入JSON</button>
                <button id="export-config-btn" class="btn-small">导出JSON</button>
                <button id="add-module-btn" class="btn-small">
                    <span>+</span> 添加模块
                </button>
            </div>
        </div>

        <!-- 模块模板（默认隐藏） -->
        <div class="module-template" style="display: none;">
            <div class="module-item">
                <div class="module-header">
                    <div class="module-name-group">
                        <span class="module-order-number"></span>
                        <label>模块名称</label>
                        <input type="text" class="module-name" placeholder="输入模块名称">
                    </div>
                    <div class="module-actions">
                        <button class="btn-small toggle-variables"><span class="arrow">▶</span><span
                                class="text">展开变量</span><span class="variable-count">(0)</span></button>
                        <button class="btn-small move-module-up" title="上移模块">▲</button>
                        <button class="btn-small move-module-down" title="下移模块">▼</button>
                        <button class="btn-small add-variable">+ 添加变量</button>
                        <button class="btn-small remove-module">- 删除模块</button>
                    </div>
                </div>

                <div class="variables-container-wrapper">
                    <div class="variables-container">
                        <!-- 变量模板 -->
                        <div class="variable-template" style="display: none;">
                            <div class="variable-item">
                                <div class="variable-name-group">
                                    <label>变量名</label>
                                    <input type="text" class="variable-name" placeholder="变量名">
                                </div>
                                <div class="variable-desc-group">
                                    <label>变量解释</label>
                                    <input type="text" class="variable-desc" placeholder="变量含义说明">
                                </div>
                                <div class="variable-actions">
                                    <button class="btn-small remove-variable">-</button>
                                </div>
                            </div>
                        </div>

                        <!-- 默认变量 -->
                        <div class="variable-item">
                            <div class="variable-name-group">
                                <label>变量名</label>
                                <input type="text" class="variable-name" placeholder="变量名">
                            </div>
                            <div class="variable-desc-group">
                                <label>变量解释</label>
                                <input type="text" class="variable-desc" placeholder="变量含义说明">
                            </div>
                            <div class="variable-actions">
                                <button class="btn-small remove-variable">-</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="module-prompt">
                    <label>模块提示词</label>
                    <textarea class="module-prompt-input" placeholder="输入模块提示词，用于指导模型如何使用此模块"></textarea>
                </div>

                <div class="module-preview">
                    <label>模块格式预览</label>
                    <input type="text" class="module-preview-text" readonly placeholder="[模块名|变量1:值1|变量2:值2...]" />
                </div>
            </div>
        </div>


    </div>

    <div class="window-actions">
        <button id="module-cancel-btn">取消</button>
        <button id="module-save-btn">保存配置</button>
    </div>
</div>